<jsp:root	xmlns="http://www.w3.org/1999/xhtml"
    		xmlns:jsp="http://java.sun.com/JSP/Page"
    		xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
			xmlns:fn="http://java.sun.com/jsp/jstl/functions" 
			xmlns:c="http://java.sun.com/jsp/jstl/core"
          	xmlns:html="http://struts.apache.org/tags-html"
    		xmlns:customtag="urn:jsptagdir:/WEB-INF/tags"
    		version="2.0">
              		
<c:url var="monsterStylesURL" value="/css/monster_styles.css" />
<link rel="StyleSheet" href="${monsterStylesURL}" type="text/css" media="all" />

<!-- URL para realizar la peticion ajax de taskManager -->
<c:url var="ajaxTasksManagerURL" value="/ajax/TaskManager.do"/>

<![CDATA[
 	<script type="text/javascript" src="javascript/image_up.js"></script>
	<script type="text/javascript" src="javascript/fix_attrs_descriptions.js"></script>
	<script type="text/javascript" src="javascript/count_down.js"></script>
]]> 

<div id="monsterLeftBlock">
<customtag:window id="MonsterTasks" titleValue="Monster.jobs.title" window_width="240">
    <div id="turns_left">
        <customtag:monsterBrief_data_row property="freeTurns">
            <span class="monster_turns">${monster.freeTurns}</span>
        </customtag:monsterBrief_data_row>
    </div>
    
    <c:choose>
    
    <c:when test="${fn:length(suggestMonsterActions) == 0}">
            <customtag:info_message key="Monster.jobs.thereIsNoJobs" icon_id="0" style="margin: 15px; width: 240px;"/>
    </c:when>
    
    <c:otherwise>
    
      <html:form action="ExecuteMonsterTasks">
        
        <html:hidden property="monsterId" value="${monster.id}"/>
    
        <c:forEach items="${suggestMonsterActions}" var="monsterAction" varStatus="loop" >
            <!--  
                 Por otro lado, esta lista debe hacerse con tags ul + li, y si la lista entera supone
                 mucho codigo y muy complejo, debera moverse para un jspf
                    -->
                    
        
            <html:hidden property="${monsterAction.type}_roomType" value="${monsterAction.room.roomType}"/>
                
            <div class="field">        
                <span class="label">
                    ${monsterAction} <!-- En vez de imprimir directamente monsterAction se compondra una clave para el fmt tag -->
                </span>
                <span class="entry">    
                    <html:text property="${monsterAction.type}"></html:text>
                </span>
            </div>
                    
        </c:forEach>
        
        <div class="button end_button">        
                <html:submit>
                    <fmt:message key="Buttons.update"/>
                </html:submit>
            </div>      
        
      </html:form>  
    </c:otherwise>
    
    </c:choose>
    
</customtag:window>
</div>

<div id="monsterRightBlock">

<!-- Monster Brief and Image -->
<customtag:window id="MonsterBrief" titleValue="${monster.name}" window_width="520">
		
	<div id="image_up_wrapper">
		<ul id="MonsterBrief_data">
		
			<!-- Cocoon count down -->
			<c:if test="${monster.age == 'Cocoon'}">
			<customtag:monsterBrief_data_row property="metamorphosisCountDown">
				<span class="countdown">
	   				<span class="c_in" style="display:none">${monster.cocoonCloseUpDateEpoch}</span>
	   				<span class="c_out">...</span>
	   			</span>
			</customtag:monsterBrief_data_row>
			</c:if>
			
			<!-- Grow to Adult button -->
			<c:if test="${monster.age == 'Child'}">
				<c:set var="title"><fmt:message key="Monster.metamorphosisToAdult" /></c:set>
			  	<c:set var="desc"><fmt:message key="Monster.metamorphosisToAdult.desc">
			  		<fmt:param value="${monster.race.metamorphosisMinutes}"/></fmt:message>
			  	</c:set>
			  	<li class="data_row">	
				  	<span id="grow_to_adult_button" class="button_box" title="${title} ${desc}">
						<html:link action="MetamorphosisToAdult.do?monsterId=${monster.id}">${title}</html:link>
				  	</span>
			  	</li>
			</c:if>
		
			<!-- Monster Age -->
			<c:set var="ageDesc"><fmt:message key="Monster.age.desc"><fmt:param value="${monster.race.liveLenght * 0.8}"/><fmt:param value="${monster.race.liveLenght}"/></fmt:message></c:set>
			<customtag:monsterBrief_data_row property="age" desc="${ageDesc}">
				<fmt:message key="Monster.age.ageDays"><fmt:param value="${monster.ageDays}"/></fmt:message> 
				(<fmt:message key="Monster.age.agePercentageLived"><fmt:param value="${monster.agePercentageLived}"/></fmt:message>)
			</customtag:monsterBrief_data_row>
			
			<!-- Job (best work skill) -->
			<c:if test="${monster.age != 'Child' and monster.age != 'Cocoon'}">
				<customtag:monsterBrief_data_row property="bestWorkSkill">
					<fmt:message key="Monster.attr.${monster.bestWorkSkill}"/>
				</customtag:monsterBrief_data_row>
			</c:if>
			
			<!-- Favorite Music (favoriteLeisure) -->
			<li class="data_row">
				<span class="data_label"><fmt:message key="Monster.favoriteLeisure"/>:</span>
				<!-- <span class="data_value">${monster.favoriteLeisure}</span> -->
				<span class="data_value">Rock'n'roll</span>
			</li>
			
		</ul>
		
		<!-- Monster Image -->
		<div id="image_up_image" style="float:left; display:none;">
			<customtag:monster_image race="${monster.race}" type="${monster.age}"/>
			<![CDATA[<script type="text/javascript">
			$(function() {
				// Metemos datos en la imagen para que puedan ser leidos por el script
				$('#image_up_image').data("race", '${monster.race}').data("ageState", '${monster.age}');
			});
			</script>]]>
		</div>
	</div>
	
</customtag:window>

<!-- Monster Attributes, Skills and Race details -->
<customtag:window id="MonsterDetails" title="Monster.details.title" window_width="520"
		tags="attributes: Monster.attr.attributes, 
			skills: Monster.attr.skills, 
			race: Monster.race">

	<div id="MonsterDetailsWrapper">
		<div id="MonsterDetails_attributes">
			<customtag:attributesList property="simpleAttrs"/>
			<customtag:attributesList property="composeAttrs"/>
		</div>
		
		<div id="MonsterDetails_skills">
			<customtag:attributesList property="workSkills"/>
		</div>
		
		<div id="MonsterDetails_race">
			<c:set var="race" value="${monster.race}"/>
			<jsp:directive.include file="_race_details.jspf"/>
		</div>
	</div>
</customtag:window>
</div>

</jsp:root>